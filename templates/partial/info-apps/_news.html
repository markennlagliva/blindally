{% extends 'base.html' %}
{% load static %}

{% block title %}
    : News Feed
{% endblock title %}

{% block script %}
<script>
    window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        // eligible speech
        const recognition = new SpeechRecognition();
        recognition.interimResults = true;

        recognition.lang = 'en-US';

        document.addEventListener("DOMContentLoaded", function() {
            isActive = false;
            instruction = false;
            isPlayingtheNews = false;
            playingNews = false;
            // isBot = false;
        });   

        function speak(text) {
            const msg = new SpeechSynthesisUtterance(text);

            msg.rate = 1;
            msg.volume = 1;
            msg.pitch = 1;

            window.speechSynthesis.speak(msg);
        };
        
        console.log('This is the Status Before: ', localStorage.getItem('status'));
        console.log('This is the Mode Before: ', localStorage.getItem('mode'));

        if (!localStorage.getItem('status')) {
    // If not, set a pre-determined default value
            localStorage.setItem('mode', 'English'); 
            localStorage.setItem('status', true);
        };


        var csrfToken = getCookie('csrftoken');
        console.log('This is the Token:', csrfToken);
        var currentUrl = window.location.href;

        let buttonStatus = document.getElementById('buttonStatus');
        let contentMode = document.getElementById('content');

       // displays current language mode dynamically
        if (localStorage.getItem('mode') == 'Filipino') {
            contentMode.textContent = localStorage.getItem('mode');
        } else {
            contentMode.textContent = localStorage.getItem('mode');
        }

        // TRUE for ENGLISH && FALSE for FILIPINO
        // Trigger for LocalStorage and for Dynamic values
        buttonStatus.addEventListener('click', function () {
            let status = localStorage.getItem('status');
           
           console.log('Hello')

           if (status === 'true') {
               localStorage.setItem('mode', 'Filipino'); 
               contentMode.textContent = localStorage.getItem('mode');
               localStorage.setItem('status', false);
           } else {
               localStorage.setItem('mode', 'English'); 
               contentMode.textContent = localStorage.getItem('mode');
               localStorage.setItem('status', true);
           }
           

           console.log('This is the Status After: ', localStorage.getItem('status'));
           console.log('This the language mode:', localStorage.getItem('mode'))
        });

        let player;
         // RETRIEVING SAVED DATA TO DISPLAY --> News
         if (localStorage.getItem('newsId') !== null && JSON.parse(localStorage.getItem('isPlayingNews'))) {
            // onYouTubeIframeAPIReady();
            
             // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');
          
          tag.src = "https://www.youtube.com/iframe_api";
          var firstScriptTag = document.getElementsByTagName('script')[0];
          firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

          // 3. This function creates an <iframe> (and YouTube player)
          //    after the API code downloads.

        
          function onYouTubeIframeAPIReady() {
            var savedVideoId = localStorage.getItem('newsId');
            if (savedVideoId) {
                
                player = new YT.Player('player', {
                height: '390',
                width: '640',
                videoId: savedVideoId,
                playerVars: {
                    'playsinline': 1,
                    'autoplay': 1,
                    'origin': "https://www.youtube.com",
                },
                events: {
                    'onReady': onPlayerReady,
                    // 'onStateChange': onPlayerStateChange
                }
                });  
                localStorage.setItem('iplayer', JSON.stringify(player))
                // console.log()
            } 
          }

          // 4. The API will call this function when the video player is ready.
          function onPlayerReady(event) {
            event.target.playVideo();
          }
          // 5. The API calls this function when the player's state changes.
          //    The function indicates that when playing a video (state=1),
          //    the player should play for six seconds and then stop.
          // var done = false;
          // function onPlayerStateChange(event) {
          //   if (event.data == YT.PlayerState.PLAYING && !done) {
          //     setTimeout(stopVideo, 6000);
          //     done = true;
          //   }
          // }
          function changeVideo(videoId) {
            
            if (player) {
            player.loadVideoById(videoId);
            } else {
            console.error('Player not initialized!');
            }
        }
          function stopVideo() {
            
            player.stopVideo();
          }

          function pauseVideo() {
             
             console.log(player.pauseVideo())
            if (player.pauseVideo) {
              player.pauseVideo();
            } 
          }

          function playVideo() {
            // player = JSON.parse(localStorage.getItem('iplayer'))
            console.log(player.playVideo)
            if (player.playVideo) {
              player.playVideo();
            
            } 
          }
                
        } else {
            document.querySelector('#audiobook-gif').style.display = 'block';
        };

        // CSRF TOKEN 
        function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                console.log('This is inside 2nd Cookie:', cookieValue)
                return cookieValue;
            };

        function details() {
            // if (JSON.parse(localStorage.getItem('isPlayingNews'))) {
            //         console.log('News Cannot be interrupted when Playing.');
            //         pauseVideo()
            //         // localStorage.setItem('isPlayingNews', false)
            //         {};
            //     } else {
                    const speakDetails = document.querySelectorAll('p');
            let theDetails = []

            speakDetails.forEach(function(par, idx){
                let parContent = par.textContent;
                theDetails.push(parContent);
            });
            
            fetch("{% url 'index' %}", {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                       'X-CSRFToken': csrfToken,
                   },
                   body: JSON.stringify({
                    //    details: allPdetails,
                       details: theDetails,
                       status: JSON.parse(localStorage.getItem('status')),
                   }),
               })
               .then(response => response.json())
               .then(data => {
                   console.log('Success', data);
               })
               .catch((error) => {
                   console.error('Error', error);
               });
            // }
        };

        /*
        // <--- Request Details by Clicking --->
            let mainElement = document.querySelector('main');


            mainElement.onclick = function () {
                // IFRAME
                // var iframe = document.getElementById('videoFrame');
                // console.log(iframe)
                // console.log(iframe.contentWindow.postMessage('{"event":"command","func":"' + 'playVideo' + '","args":""}', '*'));
                if (JSON.parse(localStorage.getItem('isPlayingNews'))) {
                    console.log('News Cannot be interrupted when Playing.');
                    pauseVideo()
                    localStorage.setItem('isPlayingNews', false)
                    {};
                } else {
                   
                    const Pdetails = document.querySelectorAll('p');
                    let allPdetails = [];
                    // console.log(Pdetails.length);
                        Pdetails.forEach(function(paragraph, index) {
                            var paragraphContent = paragraph.textContent;
                            allPdetails.push(paragraphContent);
                        });
                        
                        console.log(allPdetails)
                        
                        fetch("{% url 'newsfeed' %}", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': csrfToken,
                            },
                            body: JSON.stringify({
                                details: allPdetails,
                                status: JSON.parse(localStorage.getItem('status')),
                            }),
                        })
                        .then(response => response.json())
                        .then(data => {
                                count_click = 0
                            
                            console.log('Success', data);
                        })
                        .catch((error) => {
                            console.error('Error', error);
                        });
                        localStorage.setItem('isPlayingNews', true)
                }
            }; // End of Main.click ()

            */
   
        // START YOUTUBE API IFRAME
        
        // 2. This code loads the IFrame Player API code asynchronously.
        var tag = document.createElement('script');
          
          tag.src = "https://www.youtube.com/iframe_api";
          var firstScriptTag = document.getElementsByTagName('script')[0];
          firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

          // 3. This function creates an <iframe> (and YouTube player)
          //    after the API code downloads.

        
          function onYouTubeIframeAPIReady() {
            var savedVideoId = localStorage.getItem('newsId');
            if (savedVideoId) {
                
                player = new YT.Player('player', {
                height: '390',
                width: '640',
                videoId: savedVideoId,
                playerVars: {
                    'playsinline': 1,
                    'autoplay': 1,
                    'origin': "https://www.youtube.com",
                },
                events: {
                    'onReady': onPlayerReady,
                    // 'onStateChange': onPlayerStateChange
                }
                });  
                localStorage.setItem('iplayer', JSON.stringify(player))
                // console.log()
            } 
          }

          // 4. The API will call this function when the video player is ready.
          function onPlayerReady(event) {
            event.target.playVideo();
          }
          // 5. The API calls this function when the player's state changes.
          //    The function indicates that when playing a video (state=1),
          //    the player should play for six seconds and then stop.
          // var done = false;
          // function onPlayerStateChange(event) {
          //   if (event.data == YT.PlayerState.PLAYING && !done) {
          //     setTimeout(stopVideo, 6000);
          //     done = true;
          //   }
          // }
          function changeVideo(videoId) {
            
            if (player) {
            player.loadVideoById(videoId);
            } else {
            console.error('Player not initialized!');
            }
        }
          function stopVideo() {
            
            player.stopVideo();
          }

          function pauseVideo() {
             
             console.log(player.pauseVideo())
            if (player.pauseVideo) {
              player.pauseVideo();
            } 
          }

          function playVideo() {
            // player = JSON.parse(localStorage.getItem('iplayer'))
            console.log(player.playVideo)
            if (player.playVideo) {
              player.playVideo();
            
            } 
          }

          // END OF YOUTUBE IFRAME API
       
          // Initialization
        let isActive;
        let instruction;
        let isPlayingtheNews;
        let playingNews;
        let theAudio;

        function exit_delete_audio() {
            fetch("{% url 'delete_audio' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                },
                body: JSON.stringify({
                    //    details: allPdetails,
                    details: 'exit audio successfully.',
                    status: JSON.parse(localStorage.getItem('status')),
                }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success', data);
            })
            .catch((error) => {
                console.error('Error', error);
            });
            isPlayingtheNews = false;
        }

       const texts = document.querySelector('#texts')
       let p = document.createElement('p')
    
        // <--- THIS IS FOR NAVIGATION AND SPEAKING LOCATION PAGE --->
        window.addEventListener('load', () => {
           
            recognition.addEventListener('result', (e) => {
            const text = Array.from(e.results)
            .map(result => result[0])
            .map(result => result.transcript)
            .join('');

            console.log(text);
            
            // Navigation -> Thru Voice 
            if(e.results[0].isFinal) {

                  if (text === 'blind ally') {
                console.log('Activated, what can I do for you?');
                    if (localStorage.getItem('mode') == 'English') {
                        var audio = new Audio("{% static 'audio/activation.mp3' %}");
                    } else {
                        var audio = new Audio("{% static 'audio/fil_activation.mp3' %}");
                    };
                    audio.play();
                    isActive = true;
                };

                // <--- Feature Request --->
                // <--- Feature search --->
                        if (false) {
                        if (text.includes('gma') || text.includes('tv patrol') || text.includes('weather') || text.includes('tv5') || text.includes('abc news')) {
                        

                        let channel = text;
                        let requestChannel;
                        if (channel.includes('gma')) {
                            requestChannel = 'GMA NETWORK {{date}} LIVESTREAM'
                        } else if (channel.includes('weather')){
                            requestChannel = 'DOST-PAGASA Weather Report Public Weather Forecast issued at {{time}} | {{date}} - {{day}}'
                        } else if (channel.includes('tv5')) {
                            requestChannel = 'EAT BULAGA LIVE | TVJ ON TV5 | {{date}}'
                        } else if (channel.includes('abc news')) {
                            requestChannel = 'ABC news LIVE'
                        }
                        else {
                            requestChannel = 'ABS-CBN Entertainment {{date}} Live'
                        };

                        
                            // console.log('Cakes & Eclairs YT '+output)
                            // Define the endpoint URL
        const url = "https://www.googleapis.com/youtube/v3/search";
        console.log('{{date}}')
        // Define query parameters
        let params;
        if (text === 'abc news') {
                params = {
                part: "snippet",
                q: requestChannel,  // Replace with your search query
                type: "video",
                eventType: "live",
                maxResults: 1,  // Limit to 1 result
                key: "AIzaSyDgdZIe2Xs8ycbTzbhJZiDPP1ZstHcktu0"  // Replace with your YouTube Data API key mkenndave
            };
        } else {
            params = {
                part: "snippet",
                q: requestChannel,  // Replace with your search query
                type: "video",
                // eventType: "live",
                maxResults: 1,  // Limit to 1 result
                key: "AIzaSyDgdZIe2Xs8ycbTzbhJZiDPP1ZstHcktu0"  // Replace with your YouTube Data API key
            };
        };

        // Construct URL with query parameters
        const queryString = new URLSearchParams(params).toString();
        const fullUrl = `${url}?${queryString}`;

        // Send GET request to the API
        fetch(fullUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(data => {
                console.log(data)
                // Extract video details from response
                if (data.items && data.items.length > 0) {
                    const newsId = data.items[0].id.videoId;
                    const newsTitle = data.items[0].snippet.title;
                    
                    console.log("News ID:", newsId);
                    console.log("News Title:", newsTitle);
                    
                
                    let videoContainer = document.querySelector('#player');
                    //width="560" height="315"

                    // NEWS YOUTUBE IFRAME API
                    
                    if (localStorage.getItem('newsId') != null) {
                    
                        changeVideo(newsId);
                        localStorage.setItem('newsId', newsId);
                        localStorage.setItem('newsTitle', newsTitle);
                    } else {
                        localStorage.setItem('newsId', newsId);
                        localStorage.setItem('newsTitle', newsTitle);
                        onYouTubeIframeAPIReady();  
                    }
                    
                    // let markup = `<iframe id="videoFrame" class="embed-responsive-item" src="https://www.youtube.com/embed/${newsId}?autoplay=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> <h6 class='text-center text-white-50'>${newsTitle}</h6>`
                    
                    // let markup = `
                    // <video width="320" height="240" controls autoplay>
                    //     <source src="https://www.youtube.com/embed/${videoId}" type="video/mp4">
                    //     Your browser does not support the video tag.
                    // </video>
                    // <h6 class='text-center text-white-50'>${videoTitle}</h6>
                    // `

                    // Save the markup string to local storage
                    // localStorage.setItem('newsMarkup', markup);
                    // Later, to retrieve the saved markup from local storage
                    // var savedMarkup = localStorage.getItem('newsMarkup');

                    // NOTIFYING AND SPEAKING PURPOSES CODE
                    fetch("{% url 'newsfeed' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'Searching for live or Recent News.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });

                    // setTimeout(function() {
                    //     // Set the innerHTML after the delay
                    //     document.querySelector('#player').innerHTML = localStorage.getItem('newsMarkup');
                    // }, 4000);

                    localStorage.setItem('isPlayingNews', true);
                    // window.location.href = "{% url 'newsfeed' %}"
                
                    

                    
                } else {
                    console.log("No news found.");
                }
            })
            .catch(error => {
                console.error("Error:", error);
            });


                            
                        }; // End of request Feature Block
                    } // end of False - Not using
           
            if (playingNews) {
                if (text == 'exit'){
                    // delete audio
                    document.getElementById('searchNews').style.display = 'none';
                    document.getElementById('book-determined').style.display = 'block';
                    theAudio.pause();
                    exit_delete_audio();   
                    playingNews = false;
                    location.reload();
            
                } else if (text == 'wait') {
                    if (isPlayingtheNews) {
                        theAudio.pause();
                        isPlayingtheNews = false;
                    }
                } else if (text == 'continue') {
                    if (!isPlayingtheNews) {
                        theAudio.play();
                        isPlayingtheNews = true;
                    }
                }
            } // End playingNews not isPlayingtheNews

                    if (isActive) {
                        let availableCommands = ['blind ally', 'search', 'refresh', 'details', 'home', 'guidelines', 'audiobook', 'music', 'assistant', 'time', 'location', 'news', 'motivation', 'technology']
                        if (text === 'details') {
                            details();
                            isActive = false;

                        } 
                        else if (text.startsWith('search')) {
                            let output = text.replace(/^search\s*/, "")
                            console.log('Requested Input:', output)

                                
                                // let news_country;
                                // let news_lang;
                               
                                // if (localStorage.getItem('mode') == 'English') {
                                //     news_country = 'US';
                                //     news_lang = 'en';
                                // } else {
                                //     news_country = 'PH';
                                //     news_lang = 'tl';
                                // };
                                // const url = 'https://real-time-news-data.p.rapidapi.com/search?query=Elon%20Musk&country=US&lang=en';
                                // const options = {
                                //     method: 'GET',
                                //     headers: {
                                //         'X-RapidAPI-Key': '1cb3bdc85emsh88a3549de3600d6p1ffddcjsn92e56802c9d2',
                                //         'X-RapidAPI-Host': 'real-time-news-data.p.rapidapi.com'
                                //     }
                                // };

                                //   let news_content;
                                // // try {
                                //     // NEWS DATA FETCH
                                //     fetch(url, options)
                                //     .then(response => response.json())
                                //     .then(data => {
                                //         console.log('Success', data);

                                //         const textss = document.querySelector('#texts');
                                //         textss.style.overflowY = 'auto';
                                //         document.getElementById('book-determined').style.display = 'none';

                                //         // Fetch the HTML content of the news page
                                //       try {
                                //         fetch(data.data[0].link, {
                                           
                                //         })
                                //         .then(response => response.text())
                                //         .then(html => {
                                //             // Create a new DOM parser
                                //             const parser = new DOMParser();
                                //             // Parse the fetched HTML content
                                //             const doc = parser.parseFromString(html, 'text/html');
                                //             // Get all <p> tags
                                //             const pTags = doc.querySelectorAll('p');
                                //             // Combine the text content of all <p> tags
                                //             const combinedText = Array.from(pTags)
                                //             .map(p => p.textContent)
                                //             .join(' ');
                                //             // Log the combined text
                                //             console.log(combinedText);
                                //             news_content = combinedText;
                                //             console.log('check')
                                //         })
                                //         .catch(error => {
                                //             console.error('Error fetching or parsing the page:', error);
                                //         });
                                //     } catch (error) {
                                //     console.error('ERROR', error);
                                // }

                                //         // searchNews where Display HTML tags created and will be Appended
                                //         let searchNews = `
                                //             <div class="card-body mt-5" id="searchNews" data-aos="fade-right">
                                //                 <img src="${data.data[0].photo_url}" class="img-fluid" width="200">
                                //                 <br>
                                //                 <p class="text-white-50 h3">Title - ${data.data[0].title}</p>
                                //                 <br>
                                //                 <hr>
                                //                 <p class="text-white-50">${news_content}</p>
                                //             </div>
                                //         `;

                                //         // Ensure data is sanitized or validated before inserting into the DOM to prevent XSS attacks.
                                //         textss.innerHTML += searchNews;
                                //     })
                                //     .catch((error) => {
                                //         console.error('Error', error);
                                //     });
                                // } catch (error) {
                                //     console.error(error);
                                // }

                                // END OF REAL-TIME NEWS API

                        fetch("{% url 'news' %}", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': csrfToken,
                                
                            },
                            body: JSON.stringify({
                                details: output,
                                status: JSON.parse(localStorage.getItem('status')),
                            }),
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Success', data);

                                console.log(data.hasNews, typeof(data.hasNews))
                                console.log('Check equality', data.hasNews == true)
                                if (data.hasNews == true) {
                                    const textss = document.querySelector('#texts');
                                    textss.style.overflowY = 'auto';
                                    document.getElementById('book-determined').style.display = 'none';
                                    
                                    let searchNews = `
                                        <div class="card-body mt-5" id="searchNews" data-aos="fade-right">
                                            <img src="${data.urlToImage}" class="img-fluid" width="200">
                                            <br>
                                            <h3 class="text-white-50">${data.titleNews}</h3>
                                            <br>
                                            <hr>
                                            <p class="text-white-50">${data.content_web}</p>
                                        </div>
                                    `;


                                    // Ensure data is sanitized or validated before inserting into the DOM to prevent XSS attacks.
                                    textss.innerHTML += searchNews;
                                    var language = localStorage.getItem('mode');

                                    //logic for that AUDIO
                                    var audio = new Audio("{% static 'audio/newssound.mp3' %}");
                            
                                    theAudio = audio;
                                        
                                    audio.play();  
                                    isPlayingtheNews = true;
                                    playingNews = true;   
                                
                                } else {
                                    fetch("{% url 'newsfeed' %}", {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'X-CSRFToken': csrfToken,
                                            
                                        },
                                        body: JSON.stringify({
                                            details: 'Please try again, no news found.',
                                            status: JSON.parse(localStorage.getItem('status')),
                                        }),
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        console.log('Success', data);
                                    })
                                    .catch((error) => {
                                        console.error('Error', error);
                                    });
                                };

                            
                                
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });

                            //logic for that AUDIO
                            if (localStorage.getItem('mode') == 'English') {
                                var scrapeSound = new Audio("{% static 'audio/scrape.mp3' %}");
                            } else {
                                var scrapeSound = new Audio("{% static 'audio/fil_scrape.mp3' %}");
                            };
                            scrapeSound.play();

                        isActive = false;
                    // NEWS TEXT - exit, wait, continue
                }

                        // if (text === 'stop') {
                        //     localStorage.setItem('isPlayingNews', false);
                        //     pauseVideo()
                            
                        
                        // }; // End for STOP keyword

                        // if (text === 'play') {
                        //     localStorage.setItem('isPlayingNews', true);
                        //     playVideo()
                        

                        //     if (localStorage.getItem('newsId') === null) {
                        //             fetch("{% url 'newsfeed' %}", {
                        //             method: 'POST',
                        //             headers: {
                        //                 'Content-Type': 'application/json',
                        //                 'X-CSRFToken': csrfToken,
                                        
                        //             },
                        //             body: JSON.stringify({
                        //                 details: 'sorry, you have not requested a News TV yet.',
                        //                 status: JSON.parse(localStorage.getItem('status')),
                        //             }),
                        //         })
                        //         .then(response => response.json())
                        //         .then(data => {
                        //             console.log('Success', data);
                        //         })
                        //         .catch((error) => {
                        //             console.error('Error', error);
                        //         });
                        //     };
                        // }; // End for CONTINUTE keyword

                        else if (text === 'refresh') {
                            // Reload the current page
                            location.reload();
                            
                            // window.location.href = "{% url 'newsfeed' %}"

                            // // Create a new KeyboardEvent for the key "k"
                            // const keyEvent = new KeyboardEvent('keydown', { key: 'k' });

                            // // Dispatch the key event to simulate the key press
                            // document.dispatchEvent(keyEvent);
                        }


                        else if (text.startsWith('set') && text.includes('english')){
                            if (localStorage.getItem('mode') == 'English') {
                                fetch("{% url 'set_language' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'language already set in English mode.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                                // speak('language already set in English mode.');
                            } else {
                                // speak('setting language to english mode.')
                                fetch("{% url 'set_language' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,    
                                },
                                body: JSON.stringify({
                                    details: 'setting language to English mode.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                                localStorage.setItem('mode', 'English'); 
                                contentMode.textContent = localStorage.getItem('mode');
                                localStorage.setItem('status', true);    
                            }
                            isActive = false;
                        } else if (text.startsWith('set') && text.includes('filipino')) {
                            if (localStorage.getItem('mode') == 'Filipino') {
                                // speak('language already set in Filipino mode.');
                                fetch("{% url 'set_language' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'language already set in Filipino mode.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                            } else {
                                // speak('setting language to filipino mode.');
                                fetch("{% url 'set_language' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'setting language to filipino mode.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                                localStorage.setItem('mode', 'Filipino'); 
                                contentMode.textContent = localStorage.getItem('mode');
                                localStorage.setItem('status', false);
                            }
                            isActive = false;
                        }

                        // Starts here Keyword Voice Navigation
                        else if (text === 'home') {
                            window.location.href = "{% url 'index' %}"
                            fetch("{% url 'index' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'You are going to Home page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                            
                        }
                        else if (text === 'guidelines') {
                            window.location.href = "{% url 'guidelines' %}"
                            fetch("{% url 'guidelines' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'Going to user guidelines page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                        }
                        // Audio Apps
                        else if (text === 'audiobook') {
                            window.location.href = "{% url 'audio_book' %}"
                            fetch("{% url 'audio_book' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'You are going to audio book page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                        }
                        else if (text === 'music') {
                            window.location.href = "{% url 'audio_music' %}"
                            fetch("{% url 'audio_music' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'You are going to music page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                        }
                        // Info Apps
                        else if (text === 'assistant') {
                            window.location.href = "{% url 'assistantbot' %}"
                            // speak('you are going to assistant bot page.')
                            fetch("{% url 'assistantbot' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                },
                                body: JSON.stringify({
                                    details: 'You are going to assistant page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                        }
                        else if (text === 'time') {
                            window.location.href = "{% url 'current_time_date' %}"
                            fetch("{% url 'current_time_date' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'You are going to date and time page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                            
                        }
                        else if (text === 'location') {
                            window.location.href = "{% url 'location' %}"
                            fetch("{% url 'location' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'You are going to location page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });     
                        }
                        else if (text === 'news'){
                            window.location.href = "{% url 'newsfeed' %}"
                            fetch("{% url 'newsfeed' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                    
                                },
                                body: JSON.stringify({
                                    details: 'You are already in news page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                        }
                        else if (text === 'motivation') {
                            window.location.href = "{% url 'motivation' %}"
                            // speak('you are going to motivation page')
                            fetch("{% url 'motivation' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                },
                                body: JSON.stringify({
                                    details: 'you are going to motivation page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                        }
                        else if (text === 'technology') {
                            window.location.href = "{% url 'technologies' %}"
                            // speak('You are going to technology page.')
                            fetch("{% url 'technologies' %}", {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRFToken': csrfToken,
                                },
                                body: JSON.stringify({
                                    details: 'you are going to technology page.',
                                    status: JSON.parse(localStorage.getItem('status')),
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Success', data);
                            })
                            .catch((error) => {
                                console.error('Error', error);
                            });
                        } else if (!availableCommands.includes(text)) {
                            console.log('command not recognized')
                            if (localStorage.getItem('mode') == 'English') {
                                var audio = new Audio("{% static 'audio/notrecognized.mp3' %}");
                            } else {
                                var audio = new Audio("{% static 'audio/fil_notrecognized.mp3' %}");
                            };
                            audio.play();
                            isActive = false;
                        }
            } // end of isActive

            };
        });


        recognition.addEventListener('end', (e) => {
           recognition.start(); 
        });

        recognition.start();
    });
    
   
</script>
{% endblock script %}


{% block content %}
<div class="container-lg">
    <div class="row min-vh-100 d-flex flex-column justify-content-center align-items-center ">

        <div class="col-lg-6 align-self-lg-center text-center mt-2" data-aos="fade-right">
            <h1 class="fw-bolder text-center text-white-50"><i class="bi bi-newspaper"></i> <span style="color: #ADD8E6">Newsfeed</span></h1>
        </div>
       
        <div class="container">
            <div class="row">
                <div class="col text-center" id="texts">
                    <!-- This is where p tags are inserted -->
                    

                    <div class="container" id="book-determined">
                        <div class="row">
                            <div class="col-lg-6 align-self-lg-center align-self-end py-5" data-aos="fade-right">
                                <h3 class="fw-bolder text-center" style="color: #ADD8E6">"News in Focus: Accessible Insights for the Visually Impaired"</h3>
                                <div class="rounded-5">
                                    <!-- <p class="text-white-50">Find Your News: Navigate Channels with Ease Using Voice Commands like GMA, TV Patrol, TV5, Weather and ABC News</p> -->
                                    <p class="text-white-50">Find Your News: Say the search keyword followed by the news you wanted to seek.</p>
                                </div>
                            </div>
                            <div class="col-lg-6 d-flex flex-column align-items-center py-md-0 py-5 embed-responsive embed-responsive-16by9" data-aos="fade-right" id="player">

                                <img id="audiobook-gif" src="{% static 'assets/news.jpg' %}" width="400" class="img-fluid rounded-5">
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>
    <!-- Processing Modal -->
        <div class="modal fade d-none" id="processingModal" tabindex="-1" role="dialog" aria-labelledby="processingModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <span>Processing, please wait...</span>
                </div>
            </div>
            </div>
        </div>
  
</div>
{% endblock content %}